name: follow_facebook

on:
  workflow_dispatch:
    inputs:
      key:
        description: 'Key Tool'
        required: true
        type: string
      link:
        description: 'Link Facebook'
        required: true
        type: string

jobs:
  buff:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.0'
          extensions: curl, json, fileinfo

      - name: Run Script
        id: run_script
        continue-on-error: true
        run: php buff.php
        env:
          INPUT_KEY: ${{ github.event.inputs.key }}
          INPUT_LINK: ${{ github.event.inputs.link }}

      - name: Check Files
        if: always()
        run: |
          echo "=== DANH SÁCH FILES ==="
          ls -la
          echo ""
          echo "=== NỘI DUNG result.txt ==="
          if [ -f result.txt ]; then
            cat result.txt
          else
            echo "KHÔNG CÓ FILE result.txt"
          fi
          echo ""
          echo "=== NỘI DUNG debug.log ==="
          if [ -f debug.log ]; then
            cat debug.log
          else
            echo "KHÔNG CÓ FILE debug.log"
          fi
          echo ""
          echo "=== NỘI DUNG gist_test.log ==="
          if [ -f gist_test.log ]; then
            cat gist_test.log
          else
            echo "KHÔNG CÓ FILE gist_test.log"
          fi

      - name: Upload Logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: logs
          path: |
            result.txt
            debug.log
            gist_test.log
            *.log
          retention-days: 7
